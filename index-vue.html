<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>Moe - Chemistry Periodic Table</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="style-vue.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- SVG Icons -->
    <svg style="display: none;">
        <defs>
            <!-- Coin Icon -->
            <symbol id="icon-coin" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" fill="url(#coinGradient)" stroke="url(#coinStroke)" stroke-width="1.5"/>
                <circle cx="12" cy="12" r="7" fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                <text x="12" y="16" text-anchor="middle" font-size="10" font-weight="bold" fill="#fff">$</text>
                <defs>
                    <linearGradient id="coinGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#FFD700;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#FFA500;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#FF8C00;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="coinStroke" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#FFE55C;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#FF8C00;stop-opacity:1" />
                    </linearGradient>
                </defs>
            </symbol>
        </defs>
    </svg>

    <div id="app">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">
                    <span class="logo-icon">‚öõÔ∏è</span>
                    Moe
                </h1>
                <div class="coin-badge" @click="showShop = true">
                    <svg class="coin-icon-svg" width="28" height="28">
                        <use href="#icon-coin"></use>
                    </svg>
                    <span class="coin-amount">{{ coinBalance }}</span>
                </div>
            </div>
        </header>

        <!-- Tab Content -->
        <main class="main-content">
            <!-- Elements Tab -->
            <div v-show="activeTab === 'elements'" class="tab-panel">
                <div class="search-bar">
                    <div class="search-input-wrapper">
                        <span class="search-icon">üîç</span>
                        <input 
                            v-model="searchQuery" 
                            type="text" 
                            placeholder="Search elements..."
                            class="search-input"
                        >
                    </div>
                    <!-- ‰ΩøÁî®AppÈ£éÊ†ºÁöÑ‰∏ãÊãâËèúÂçï -->
                    <div class="category-dropdown-wrapper">
                        <button class="category-dropdown-btn" @click="toggleCategoryDropdown">
                            <span>{{ categoryFilter ? getCategoryName(categoryFilter) : 'All Categories' }}</span>
                            <span class="dropdown-arrow">{{ categoryDropdownOpen ? '‚ñ≤' : '‚ñº' }}</span>
                        </button>
                        <div v-if="categoryDropdownOpen" class="category-dropdown-menu">
                            <div class="dropdown-item" :class="{ active: !categoryFilter }" @click="selectCategory('')">
                                All Categories
                            </div>
                            <div class="dropdown-item" :class="{ active: categoryFilter === 'alkali-metal' }" @click="selectCategory('alkali-metal')">
                                Alkali Metal
                            </div>
                            <div class="dropdown-item" :class="{ active: categoryFilter === 'alkaline-earth-metal' }" @click="selectCategory('alkaline-earth-metal')">
                                Alkaline Earth
                            </div>
                            <div class="dropdown-item" :class="{ active: categoryFilter === 'transition-metal' }" @click="selectCategory('transition-metal')">
                                Transition Metal
                            </div>
                            <div class="dropdown-item" :class="{ active: categoryFilter === 'nonmetal' }" @click="selectCategory('nonmetal')">
                                Nonmetal
                            </div>
                            <div class="dropdown-item" :class="{ active: categoryFilter === 'halogen' }" @click="selectCategory('halogen')">
                                Halogen
                            </div>
                            <div class="dropdown-item" :class="{ active: categoryFilter === 'noble-gas' }" @click="selectCategory('noble-gas')">
                                Noble Gas
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="element-grid">
                    <div 
                        v-for="element in filteredElements" 
                        :key="element.atomicNumber"
                        class="element-card"
                        :class="'category-' + element.category"
                        @click="showElementDetail(element)"
                    >
                        <div class="element-number">{{ element.atomicNumber }}</div>
                        <div class="element-symbol">{{ element.symbol }}</div>
                        <div class="element-name">{{ element.name }}</div>
                    </div>
                </div>
            </div>

            <!-- Quiz Tab -->
            <div v-show="activeTab === 'quiz'" class="tab-panel">
                <div class="quiz-container">
                    <div class="quiz-header">
                        <h2>üéØ Element Quiz</h2>
                        <div class="quiz-stats">
                            <div class="stat-badge">
                                <span class="stat-label">Score</span>
                                <span class="stat-value">{{ quizScore }}</span>
                            </div>
                            <div class="stat-badge">
                                <span class="stat-label">Streak</span>
                                <span class="stat-value">{{ quizStreak }}</span>
                            </div>
                        </div>
                    </div>

                    <div v-if="!isFeatureUnlocked('quiz_bank')" class="feature-locked">
                        <div class="lock-icon">üîí</div>
                        <h3>Quiz Bank Locked</h3>
                        <p>Unlock to access chemistry questions</p>
                        <button class="btn-primary" @click="unlockFeature(unlockableFeatures.find(f => f.id === 'quiz_bank'))">
                            Unlock for 15 Coins
                        </button>
                    </div>

                    <div v-else class="quiz-content">
                        <div class="question-card">
                            <p class="question-text">{{ currentQuestion.question }}</p>
                            <div class="options-grid">
                                <button
                                    v-for="(option, index) in currentQuestion.options"
                                    :key="index"
                                    class="option-btn"
                                    :class="getOptionClass(index)"
                                    @click="selectAnswer(index)"
                                    :disabled="quizAnswered"
                                >
                                    {{ option }}
                                </button>
                            </div>
                            <div v-if="quizAnswered" class="quiz-result" :class="quizCorrect ? 'correct' : 'incorrect'">
                                <p>{{ quizCorrect ? '‚úì Correct!' : '‚úó Incorrect' }}</p>
                                <button class="btn-next" @click="nextQuestion">Next Question</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Check-in Tab -->
            <div v-show="activeTab === 'checkin'" class="tab-panel">
                <div class="checkin-container">
                    <div class="section-header">
                        <h2>üì∏ Study Check-in</h2>
                        <button class="btn-primary" @click="showCheckinModal = true">
                            <span>+ New</span>
                        </button>
                    </div>

                    <div v-if="checkIns.length === 0" class="empty-state">
                        <div class="empty-icon">üì∑</div>
                        <p>No check-ins yet</p>
                        <p class="empty-hint">Start recording your chemistry journey!</p>
                    </div>

                    <div v-else class="checkin-grid">
                        <div v-for="checkin in checkIns" :key="checkin.id" class="checkin-card">
                            <img :src="checkin.photoDataUrl" class="checkin-image" alt="Check-in">
                            <div class="checkin-info">
                                <div class="checkin-header">
                                    <div class="checkin-date">{{ formatDate(checkin.timestamp) }}</div>
                                    <button class="btn-delete-checkin" @click="deleteCheckin(checkin.id)">üóëÔ∏è</button>
                                </div>
                                <div v-if="checkin.elementTags.length" class="checkin-tags">
                                    <span v-for="tag in checkin.elementTags" :key="tag" class="tag">
                                        {{ getElementSymbol(tag) }}
                                    </span>
                                </div>
                                <p v-if="checkin.notes" class="checkin-notes">{{ checkin.notes }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Compare Tab -->
            <div v-show="activeTab === 'compare'" class="tab-panel">
                <div class="compare-container">
                    <div class="section-header">
                        <h2>‚öñÔ∏è Compare Elements</h2>
                        <button class="btn-primary" @click="showElementSelection = true" :disabled="!isFeatureUnlocked('element_comparison')">
                            Select
                        </button>
                    </div>

                    <div v-if="!isFeatureUnlocked('element_comparison')" class="feature-locked">
                        <div class="lock-icon">üîí</div>
                        <h3>Comparison Locked</h3>
                        <p>Compare elements side by side</p>
                        <button class="btn-primary" @click="unlockFeature(unlockableFeatures.find(f => f.id === 'element_comparison'))">
                            Unlock for 12 Coins
                        </button>
                    </div>

                    <div v-else-if="selectedElements.length === 0" class="empty-state">
                        <div class="empty-icon">‚öñÔ∏è</div>
                        <p>No elements selected</p>
                        <p class="empty-hint">Select 2-3 elements to compare</p>
                    </div>

                    <div v-else class="comparison-wrapper">
                        <div class="comparison-table-responsive">
                            <table class="comparison-table-modern">
                                <thead>
                                    <tr class="header-row">
                                        <th class="property-col">Property</th>
                                        <th v-for="el in selectedElements" :key="el.atomicNumber" class="element-col">
                                            <div class="element-header-cell">
                                                <div class="element-symbol-small">{{ el.symbol }}</div>
                                                <div class="element-name-small">{{ el.name }}</div>
                                            </div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="prop in getComparisonProperties()" :key="prop.label" class="data-row" :class="{ 'row-same': prop.same }">
                                        <td class="property-label">
                                            <span class="property-text">{{ prop.label }}</span>
                                            <span v-if="prop.same" class="same-indicator">‚úì</span>
                                        </td>
                                        <td v-for="(value, index) in prop.values" :key="index" 
                                            class="value-cell"
                                            :class="{ 'same-value': prop.same, 'diff-value': !prop.same }">
                                            <span class="value-badge" :class="{ 'badge-same': prop.same, 'badge-diff': !prop.same }">
                                                {{ value }}
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <button class="btn-secondary full-width" @click="selectedElements = []">Clear Selection</button>
                    </div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div v-show="activeTab === 'profile'" class="tab-panel">
                <div class="profile-container">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üî¨</div>
                            <div class="stat-number">{{ stats.elementsViewed }}</div>
                            <div class="stat-label">Elements Viewed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üì∏</div>
                            <div class="stat-number">{{ stats.checkins }}</div>
                            <div class="stat-label">Check-ins</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üéØ</div>
                            <div class="stat-number">{{ stats.quizzesTaken }}</div>
                            <div class="stat-label">Quizzes</div>
                        </div>
                    </div>

                    <!-- Help Guide -->
                    <div class="profile-section">
                        <h3>üìñ Help</h3>
                        <div class="guide-card" @click="showGuideModal = true">
                            <div class="guide-icon">üí°</div>
                            <div class="guide-text">
                                <h4>How to Use This App</h4>
                                <p>Learn about features and how to get started</p>
                            </div>
                            <div class="guide-arrow">‚Ä∫</div>
                        </div>
                    </div>

                    <div class="profile-section">
                        <h3>‚öôÔ∏è Settings</h3>
                        <div class="settings-list">
                            <div class="setting-item" @click="openWebView('Privacy Policy', 'https://rook.vandrur.com/UserPrivacyPolicyStatement.html')">
                                <span>Privacy Policy</span>
                                <span>‚Ä∫</span>
                            </div>
                            <div class="setting-item" @click="openWebView('Terms of Service', 'https://rook.vandrur.com/UniversalUserTerms.html')">
                                <span>Terms of Service</span>
                                <span>‚Ä∫</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button 
                v-for="tab in tabs" 
                :key="tab.id"
                class="nav-item"
                :class="{ active: activeTab === tab.id }"
                @click="activeTab = tab.id"
            >
                <span class="nav-icon">{{ tab.icon }}</span>
                <span class="nav-label">{{ tab.label }}</span>
            </button>
        </nav>

        <!-- Modals -->
        <!-- Element Detail Modal -->
        <div v-if="selectedElement" class="modal" @click.self="selectedElement = null">
            <div class="modal-content element-detail-modal">
                <button class="modal-close" @click="selectedElement = null">√ó</button>
                
                <div class="element-header">
                    <div class="element-symbol-large" :class="'category-' + selectedElement.category">
                        {{ selectedElement.symbol }}
                    </div>
                    <div class="element-title">
                        <h2>{{ selectedElement.name }}</h2>
                        <p class="element-category">{{ getCategoryName(selectedElement.category) }}</p>
                    </div>
                </div>

                <div class="detail-section">
                    <h3>‚öõÔ∏è Basic Properties</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <span class="detail-label">Atomic Number</span>
                            <span class="detail-value">{{ selectedElement.atomicNumber }}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Atomic Mass</span>
                            <span class="detail-value">{{ selectedElement.atomicMass }}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Category</span>
                            <span class="detail-value">{{ getCategoryName(selectedElement.category) }}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Discovery Year</span>
                            <span class="detail-value">{{ selectedElement.discoveryYear }}</span>
                        </div>
                        <div class="detail-item full-width">
                            <span class="detail-label">Electron Configuration</span>
                            <span class="detail-value">{{ selectedElement.electronConfiguration }}</span>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3>üå°Ô∏è Physical Properties</h3>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <span class="detail-label">Melting Point</span>
                            <span class="detail-value">{{ selectedElement.meltingPoint }}¬∞C</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Boiling Point</span>
                            <span class="detail-value">{{ selectedElement.boilingPoint }}¬∞C</span>
                        </div>
                        <div class="detail-item full-width">
                            <span class="detail-label">Density</span>
                            <span class="detail-value">{{ selectedElement.density }} g/cm¬≥</span>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h3>üìù Description</h3>
                    <p class="element-description">{{ selectedElement.description }}</p>
                </div>

                <button 
                    v-if="!isFeatureUnlocked('hd_charts_' + selectedElement.atomicNumber)"
                    class="btn-primary full-width"
                    @click="unlockHDChart(selectedElement.atomicNumber)"
                >
                    Unlock HD Charts (10 coins)
                </button>
                <div v-else class="unlock-badge">
                    ‚úì HD Charts Unlocked
                </div>
            </div>
        </div>

        <!-- Shop Modal -->
        <div v-if="showShop" class="modal" @click.self="showShop = false">
            <div class="modal-content shop-modal">
                <button class="modal-close" @click="showShop = false">√ó</button>
                <h2>üí∞ Coin Shop</h2>
                
                <div class="shop-content">
                    <h3>Standard Packages</h3>
                    <div class="package-grid">
                        <div 
                            v-for="pkg in standardPackages" 
                            :key="pkg.code"
                            class="package-card"
                            @click="purchasePackage(pkg)"
                        >
                            <div v-if="pkg.discount" class="package-badge">-{{ pkg.discount }}%</div>
                            <div class="package-coins">{{ pkg.coins }}</div>
                            <svg class="package-icon-svg" width="48" height="48">
                                <use href="#icon-coin"></use>
                            </svg>
                            <div class="package-price">{{ pkg.price }}</div>
                        </div>
                    </div>

                    <h3>Promotional Packages</h3>
                    <div class="package-grid">
                        <div 
                            v-for="pkg in promotionalPackages" 
                            :key="pkg.code"
                            class="package-card promo"
                            @click="purchasePackage(pkg)"
                        >
                            <div class="package-badge">-{{ pkg.discount }}%</div>
                            <div class="package-coins">{{ pkg.coins }}</div>
                            <svg class="package-icon-svg" width="48" height="48">
                                <use href="#icon-coin"></use>
                            </svg>
                            <div class="package-price">{{ pkg.price }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Check-in Modal -->
        <div v-if="showCheckinModal" class="modal" @click.self="showCheckinModal = false">
            <div class="modal-content">
                <button class="modal-close" @click="showCheckinModal = false">√ó</button>
                <h2>üì∏ New Check-in</h2>
                
                <div class="checkin-form">
                    <input 
                        type="file" 
                        ref="photoInput" 
                        accept="image/*" 
                        capture="environment"
                        style="display: none"
                        @change="handlePhotoSelect"
                    >
                    <button class="btn-photo" @click="$refs.photoInput.click()">
                        {{ currentPhoto ? 'Change Photo' : 'Take Photo / Choose Image' }}
                    </button>
                    
                    <div v-if="currentPhoto" class="photo-preview">
                        <img :src="currentPhoto" alt="Preview">
                    </div>

                    <div class="form-group">
                        <label>Related Elements (e.g., H,O)</label>
                        <input v-model="checkinTags" type="text" placeholder="Enter symbols separated by comma">
                    </div>

                    <div class="form-group">
                        <label>Notes</label>
                        <textarea v-model="checkinNotes" placeholder="Record your study notes..."></textarea>
                    </div>

                    <button class="btn-primary full-width" @click="submitCheckin">
                        Submit Check-in
                    </button>
                </div>
            </div>
        </div>

        <!-- Element Selection Modal -->
        <div v-if="showElementSelection" class="modal" @click.self="showElementSelection = false">
            <div class="modal-content">
                <button class="modal-close" @click="showElementSelection = false">√ó</button>
                <h2>Select Elements (2-3)</h2>
                
                <div class="element-selection-grid">
                    <div 
                        v-for="element in elements" 
                        :key="element.atomicNumber"
                        class="selection-card"
                        :class="{ selected: isElementSelected(element) }"
                        @click="toggleElementSelection(element)"
                    >
                        <div class="element-number">{{ element.atomicNumber }}</div>
                        <div class="element-symbol">{{ element.symbol }}</div>
                        <div class="element-name">{{ element.name }}</div>
                    </div>
                </div>

                <button 
                    class="btn-primary full-width"
                    :disabled="selectedElements.length < 2"
                    @click="confirmSelection"
                >
                    Compare Selected ({{ selectedElements.length }})
                </button>
            </div>
        </div>

        <!-- Loading -->
        <div v-if="loading" class="loading-overlay">
            <div class="spinner"></div>
            <p>Processing...</p>
        </div>

        <!-- Alert -->
        <div v-if="alert.show" class="alert-overlay" @click.self="alert.show = false">
            <div class="alert-box">
                <h3>{{ alert.title }}</h3>
                <p>{{ alert.message }}</p>
                <div class="alert-buttons">
                    <button 
                        v-for="(btn, index) in alert.buttons" 
                        :key="index"
                        :class="'btn-' + btn.style"
                        @click="btn.action"
                    >
                        {{ btn.text }}
                    </button>
                </div>
            </div>
        </div>

        <!-- User Guide Modal -->
        <div v-if="showGuideModal" class="modal" @click.self="showGuideModal = false">
            <div class="modal-content guide-modal">
                <button class="modal-close" @click="showGuideModal = false">√ó</button>
                <h2>üìñ How to Use This App</h2>
                
                <div class="guide-content">
                    <div class="guide-section">
                        <h3>üî¨ Elements Tab</h3>
                        <ul class="guide-list">
                            <li><strong>Browse Elements:</strong> View all chemical elements in the periodic table</li>
                            <li><strong>Search:</strong> Use the search bar to find elements by name, symbol, or atomic number</li>
                            <li><strong>Filter by Category:</strong> Click the category dropdown to filter elements by type (Alkali Metal, Noble Gas, etc.)</li>
                            <li><strong>View Details:</strong> Tap any element card to see detailed information including properties, electron configuration, and description</li>
                            <li><strong>Unlock HD Charts:</strong> Spend 10 coins to unlock high-definition electron cloud models for each element</li>
                        </ul>
                    </div>

                    <div class="guide-section">
                        <h3>üéØ Quiz Tab</h3>
                        <ul class="guide-list">
                            <li><strong>Test Your Knowledge:</strong> Answer chemistry questions to test your understanding</li>
                            <li><strong>Track Your Score:</strong> See your total score and current streak</li>
                            <li><strong>Unlock Quiz Bank:</strong> Spend 15 coins to access the full question bank with 30+ questions</li>
                            <li><strong>Learn as You Go:</strong> Each question shows the correct answer after you submit</li>
                        </ul>
                    </div>

                    <div class="guide-section">
                        <h3>üì∏ Check-in Tab</h3>
                        <ul class="guide-list">
                            <li><strong>Record Your Study:</strong> Take photos of your chemistry experiments or notes</li>
                            <li><strong>Tag Elements:</strong> Add element symbols (e.g., H, O, C) to categorize your check-ins</li>
                            <li><strong>Add Notes:</strong> Write observations or thoughts about your study session</li>
                            <li><strong>Delete Check-ins:</strong> Tap the trash icon to remove any check-in</li>
                        </ul>
                    </div>

                    <div class="guide-section">
                        <h3>‚öñÔ∏è Compare Tab</h3>
                        <ul class="guide-list">
                            <li><strong>Unlock Feature:</strong> Spend 12 coins to unlock element comparison</li>
                            <li><strong>Select Elements:</strong> Choose 2-3 elements to compare side by side</li>
                            <li><strong>View Properties:</strong> Compare atomic number, mass, melting point, boiling point, and more</li>
                            <li><strong>Identify Similarities:</strong> Properties marked with ‚úì are the same across all selected elements</li>
                        </ul>
                    </div>

                    <div class="guide-section">
                        <h3>üí∞ Coins System</h3>
                        <ul class="guide-list">
                            <li><strong>Starting Balance:</strong> You begin with 100 coins</li>
                            <li><strong>Purchase Coins:</strong> Tap the coin badge in the header to buy more coins</li>
                            <li><strong>Unlock Features:</strong> Use coins to unlock HD charts (10 coins), Quiz Bank (15 coins), Element Comparison (12 coins), and more</li>
                            <li><strong>One-Time Unlocks:</strong> Most features are unlocked permanently after purchase</li>
                        </ul>
                    </div>

                    <div class="guide-section">
                        <h3>üë§ Profile Tab</h3>
                        <ul class="guide-list">
                            <li><strong>View Statistics:</strong> Track how many elements you've viewed, check-ins created, and quizzes taken</li>
                            <li><strong>Access Settings:</strong> View Privacy Policy and Terms of Service</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="data-vue.js"></script>
    <script src="app-vue.js"></script>
</body>
</html>
